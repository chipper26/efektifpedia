<!doctype html>
<html lang="id">
<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.0.2/dist/css/bootstrap.min.css" rel="stylesheet">
    <link rel="stylesheet" href="style.css">
    <title>Blog - Efektifpedia</title>
    <style>
        html, body { height: 100%; margin: 0; }
        body { display: flex; flex-direction: column; background-color: #f4f7f6; padding-top: 70px; }
        .content-wrapper { flex: 1 0 auto; }
        footer { flex-shrink: 0; }

        .card-blog { border: none; background: none; border-bottom: 1px solid #dee2e6; margin-bottom: 25px; padding-bottom: 25px; }
        .card-blog img { width: 100%; height: 250px; object-fit: cover; border-radius: 8px; background-color: #eee; transition: 0.3s; }
        .card-blog img:hover { opacity: 0.9; }
        
        .category-badge { background: #e9ecef; color: #0d6efd; padding: 4px 12px; border-radius: 4px; font-size: 0.75rem; text-transform: uppercase; font-weight: bold; margin-bottom: 10px; display: inline-block; text-decoration: none; transition: 0.2s; }
        .category-badge:hover { background: #0d6efd; color: white; cursor: pointer; }
        
        .blog-title { font-weight: 700; color: #212529; text-decoration: none; font-size: 1.4rem; line-height: 1.3; display: block; }
        .blog-title:hover { color: #0d6efd; }
        .meta-info { font-size: 0.85rem; color: #6c757d; margin-top: 10px; }
        
        .sidebar-title { font-weight: bold; text-transform: uppercase; border-bottom: 2px solid #0d6efd; padding-bottom: 5px; margin-bottom: 15px; font-size: 0.9rem; }
        
        .list-category { list-style: none; padding: 0; }
        .cat-link { text-decoration: none; color: #444; font-size: 0.95rem; display: block; padding: 6px 10px; border-radius: 5px; transition: 0.2s; }
        .cat-link:hover, .cat-link.active { background: #0d6efd; color: white !important; }

        .popular-item { list-style: none; padding: 0; }
        .popular-item li { padding: 10px 0; border-bottom: 1px solid #eee; display: flex; align-items: flex-start; }
        .popular-item li::before { content: "‚óè"; color: #0d6efd; margin-right: 10px; font-size: 0.8rem; }
        .popular-link { text-decoration: none; color: #333; font-weight: 500; font-size: 0.9rem; line-height: 1.4; }
        
        .pagination .page-link { color: #0d6efd; border: none; margin: 0 3px; border-radius: 5px; font-weight: bold; box-shadow: 0 2px 4px rgba(0,0,0,0.05); }
        .pagination .page-item.active .page-link { background-color: #0d6efd; color: white; }
        .pagination .page-item.disabled .page-link { color: #ccc; pointer-events: none; }

        @media (max-width: 768px) {
            .card-blog img { height: 200px; }
            .blog-title { font-size: 1.2rem; }
        }
    </style>
</head>
<body>
    <nav class="navbar navbar-expand-lg navbar-dark bg-primary fixed-top shadow-sm">
        <div class="container">
            <a class="navbar-brand fw-bold" href="./">efektifpedia</a>
            <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarNav">
                <span class="navbar-toggler-icon"></span>
            </button>
            <div class="collapse navbar-collapse" id="navbarNav">
                <ul class="navbar-nav ms-auto">
                    <li class="nav-item"><a class="nav-link" href="./">HOME</a></li>
                    <li class="nav-item"><a class="nav-link active" href="blog.html">BLOG</a></li>
                </ul>
            </div>
        </div>
    </nav>

    <div class="content-wrapper">
        <div class="container mt-4">
            <div class="row">
                <div class="col-lg-8">
                    <h5 class="sidebar-title" id="display-title">POSTINGAN TERBARU</h5>
                    <div id="blog-container">
                        <div class="text-center p-5">
                            <div class="spinner-border text-primary"></div>
                            <p class="mt-2">Mensejajarkan data...</p>
                        </div>
                    </div>
                    <nav aria-label="Page navigation" class="mt-4 mb-5">
                        <ul class="pagination justify-content-center" id="pagination-container"></ul>
                    </nav>
                </div>

                <div class="col-lg-4 mt-5 mt-lg-0">
                    <div class="sticky-top" style="top: 90px;">
                        <h5 class="sidebar-title">KATEGORI</h5>
                        <ul class="list-category mb-4">
                            <li><a href="blog.html" class="cat-link" data-category="all">Semua Topik</a></li>
                            <li><a href="?cat=Edukasi" class="cat-link" data-category="Edukasi">Edukasi</a></li>
                            <li><a href="?cat=Tips" class="cat-link" data-category="Tips">Tips</a></li>
                            <li><a href="?cat=Tech News" class="cat-link" data-category="Tech News">Tech News</a></li>
                            <li><a href="?cat=Digital Insight" class="cat-link" data-category="Digital Insight">Digital Insight</a></li>
                            <li><a href="?cat=Review & Tutorial" class="cat-link" data-category="Review & Tutorial">Review & Tutorial</a></li>
                            <li><a href="?cat=Innovation" class="cat-link" data-category="Innovation">Innovation</a></li>
                        </ul>
                        <h5 class="sidebar-title">ARTIKEL TERPOPULER</h5>
                        <ul class="popular-item" id="popular-container"></ul>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <footer class="bg-primary text-white text-center py-4">
        <div class="container">
            <div class="mb-2">
                <a href="redaksi.html" class="text-white text-decoration-none mx-2 small">REDAKSI</a> | 
                <a href="blog.html" class="text-white text-decoration-none mx-2 small">BLOG</a>
            </div>
            <p class="m-0 small">created by üî∂ irawan</p>
        </div>
    </footer>

    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.0.2/dist/js/bootstrap.bundle.min.js"></script>
    
    <script>
        let allPosts = [];
        let filteredPosts = [];
        const postsPerPage = 6;
        let currentPage = 1;

        async function fetchAllData() {
            const repo = "Keyy26-git/efektifpedia-content";
            const container = document.getElementById('blog-container');
            
            try {
                const response = await fetch(`https://api.github.com/repos/${repo}/contents/blog`);
                const files = await response.json();
                const mdFiles = files.filter(f => f.name.endsWith('.md'));

                const loadedPosts = await Promise.all(mdFiles.map(async file => {
                    const rawRes = await fetch(file.download_url);
                    const markdown = await rawRes.text();
                    
                    let title = file.name.replace('.md', '').replace(/-/g, ' ');
                    let thumb = "https://via.placeholder.com/800x450?text=Efektifpedia";
                    let author = "Tim Efektifpedia";
                    let category = "Uncategorized";
                    let dateObj = new Date(0);
                    let dateStr = "";

                    if (markdown.startsWith('---')) {
                        const fm = markdown.split('---')[1];
                        const getVal = (key) => {
                            const regex = new RegExp(`${key}:\\s*["']?(.*?)["']?\\s*(?:\\r?\\n|$)`, 'i');
                            const match = fm.match(regex);
                            return match ? match[1].trim() : null;
                        };

                        title = getVal('title') || title;
                        author = getVal('author') || author;
                        category = getVal('category') || category;
                        
                        const dateVal = getVal('date');
                        if (dateVal) {
                            dateObj = new Date(dateVal);
                            dateStr = dateObj.toLocaleDateString('id-ID', { day: 'numeric', month: 'long', year: 'numeric' });
                        }

                        const thumbPath = getVal('thumbnail');
                        if (thumbPath) {
                            thumb = thumbPath.startsWith('http') ? thumbPath : `https://raw.githubusercontent.com/${repo}/main/${thumbPath}`;
                        }
                    }
                    return { fileName: file.name, title, author, category, thumb, dateStr, dateObj };
                }));

                allPosts = loadedPosts.sort((a, b) => b.dateObj.getTime() - a.dateObj.getTime());
                renderPopular();
                handleRouting();

            } catch (e) {
                console.error("Error:", e);
                container.innerHTML = "<p class='text-center p-5'>Gagal memproses daftar artikel.</p>";
            }
        }

        function handleRouting() {
            const params = new URLSearchParams(window.location.search);
            const cat = params.get('cat');
            
            document.querySelectorAll('.cat-link').forEach(link => {
                link.classList.remove('active');
                if (link.getAttribute('data-category') === (cat || 'all')) link.classList.add('active');
            });

            if (cat) {
                filteredPosts = allPosts.filter(p => p.category.toLowerCase() === cat.toLowerCase());
                document.getElementById('display-title').innerText = `KATEGORI: ${cat}`;
            } else {
                filteredPosts = allPosts;
                document.getElementById('display-title').innerText = `POSTINGAN TERBARU`;
            }
            
            renderBlogPage(1);
        }

        function renderBlogPage(page) {
            currentPage = page;
            const container = document.getElementById('blog-container');
            container.innerHTML = '';

            const start = (page - 1) * postsPerPage;
            const currentItems = filteredPosts.slice(start, start + postsPerPage);

            if (currentItems.length === 0) {
                container.innerHTML = "<p class='text-center p-5'>Belum ada artikel.</p>";
                document.getElementById('pagination-container').innerHTML = '';
                return;
            }

            currentItems.forEach(post => {
                container.innerHTML += `
                    <div class="card card-blog">
                        <a href="post.html?file=${post.fileName}">
                            <img src="${post.thumb}" onerror="this.src='https://via.placeholder.com/800x450?text=No+Image'" class="mb-3" alt="${post.title}">
                        </a>
                        <a href="?cat=${post.category}" class="category-badge">${post.category}</a>
                        <a href="post.html?file=${post.fileName}" class="blog-title text-capitalize">${post.title}</a>
                        <div class="meta-info">Oleh ${post.author} ‚Äî ${post.dateStr}</div>
                    </div>`;
            });

            renderPagination();
            window.scrollTo(0,0);
        }

        function renderPagination() {
            const pagination = document.getElementById('pagination-container');
            const totalPages = Math.ceil(filteredPosts.length / postsPerPage);
            pagination.innerHTML = '';

            if (totalPages <= 1) return;

            // Tombol First & Prev
            pagination.innerHTML += `
                <li class="page-item ${currentPage === 1 ? 'disabled' : ''}">
                    <button class="page-link" onclick="renderBlogPage(1)" title="Halaman Pertama">¬´</button>
                </li>
                <li class="page-item ${currentPage === 1 ? 'disabled' : ''}">
                    <button class="page-link" onclick="renderBlogPage(${currentPage - 1})" title="Sebelumnya">‚Äπ</button>
                </li>`;

            // Logika Jendela Nomor (Maksimal 5 nomor tampil)
            let startPage = Math.max(1, currentPage - 2);
            let endPage = Math.min(totalPages, startPage + 4);

            if (endPage - startPage < 4) {
                startPage = Math.max(1, endPage - 4);
            }

            for (let i = startPage; i <= endPage; i++) {
                if (i < 1) continue;
                pagination.innerHTML += `
                    <li class="page-item ${i === currentPage ? 'active' : ''}">
                        <button class="page-link" onclick="renderBlogPage(${i})">${i}</button>
                    </li>`;
            }

            // Tombol Next & Last
            pagination.innerHTML += `
                <li class="page-item ${currentPage === totalPages ? 'disabled' : ''}">
                    <button class="page-link" onclick="renderBlogPage(${currentPage + 1})" title="Selanjutnya">‚Ä∫</button>
                </li>
                <li class="page-item ${currentPage === totalPages ? 'disabled' : ''}">
                    <button class="page-link" onclick="renderBlogPage(${totalPages})" title="Halaman Terakhir">¬ª</button>
                </li>`;
        }

        function renderPopular() {
            const container = document.getElementById('popular-container');
            container.innerHTML = '';
            allPosts.slice(0, 5).forEach(post => {
                container.innerHTML += `<li><a href="post.html?file=${post.fileName}" class="popular-link text-capitalize">${post.title}</a></li>`;
            });
        }

        fetchAllData();
    </script>
    
    <script src="ramadan.js"></script>
</body>
</html>